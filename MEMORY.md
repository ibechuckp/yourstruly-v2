# YoursTruly v2 - Project Memory

*Last updated: 2026-02-21*

## Project Overview

**What:** Digital legacy platform - document your life, create AI version of yourself, send future messages
**Stack:** Next.js 16, Supabase, React, Tailwind, Framer Motion
**Repo:** Fresh build (not the Laravel v1)

## Database

- **Supabase Project:** `ffgetlejrwhpwvwtviqm.supabase.co`
- **25 migrations** pushed as of 2026-02-21
- **Key tables:** profiles, contacts, memories, memory_media, postscripts, engagement_prompts, prompt_templates, knowledge_entries

## Engagement Bubbles System

### Architecture
- `useEngagementPrompts` hook fetches prompts via `shuffle_engagement_prompts` RPC
- Prompts are generated by `generate_engagement_prompts` function based on:
  - Photos needing backstory
  - Untagged faces
  - Contacts missing info
  - Interest/skill/hobby-based templates
  - Seasonal prompts

### Prompt Types
| Type | Icon | Purpose |
|------|------|---------|
| photo_backstory | ğŸ“¸ | Get story behind a photo |
| tag_person | ğŸ‘¤ | Identify person in photo |
| missing_info | ğŸ“ | Fill contact's missing field |
| quick_question | ğŸ‘¤ | Quick contact verification |
| memory_prompt | ğŸ’­ | Record a memory |
| knowledge | ğŸ§  | Capture wisdom/advice |
| postscript | ğŸ’Œ | Create future message |
| favorites_firsts | ğŸ† | Document favorites/firsts |

### Key Files
- `src/app/(dashboard)/dashboard/page.tsx` â€” Main dashboard with inline bubble rendering
- `src/components/engagement/EngagementBubbles.tsx` â€” Standalone component (not used by dashboard)
- `src/components/engagement/Bubble.tsx` â€” Individual bubble component
- `src/hooks/useEngagementPrompts.ts` â€” Data fetching hook
- `src/styles/engagement.css` â€” Bubble styles
- `src/styles/home.css` â€” Dashboard/home page styles

### UI Specs (as of 2026-02-21)
- **Tile size:** 240x210px
- **Gap:** 24px
- **Container:** 816x468px (3 cols Ã— 2 rows)
- **Background:** Solid white (#ffffff)
- **No rotation, no dragging**
- **Expanded tile width:** 360px

### Progress Tracker
- Shows at top of engagement area
- Completed tiles shrink and animate into tracker as thumbnails (40x40px)
- Newest completions appear on left
- Shows photo, contact avatar initial, or type emoji

### Contact Name Resolution
Dashboard's `getContactName()` checks (in order):
1. `prompt.contactName`
2. `prompt.contact_name`
3. `prompt.metadata?.contact?.name`
4. `prompt.metadata?.contact?.full_name`
5. `prompt.metadata?.suggested_contact_name`
6. Falls back to user's contacts list (deterministic by prompt ID)

### Contact Form (Missing Info)
When prompt has `missingField`, shows specific input:
- `birth_date` / `date_of_birth` â†’ Date picker
- `phone` â†’ Tel input
- `email` â†’ Email input
- `contact_info` â†’ Phone + Email fields
- Other â†’ Textarea

## Views (Database)
- `contacts_missing_info` â€” Contacts with null birth_date, how_met, or contact info
- `photos_needing_backstory` â€” Photos without descriptions
- `untagged_faces` â€” Detected faces not linked to contacts

## Known Issues / TODOs
- [ ] Contact prompts showing "Tell us more about this contact" are generic (no missingField)
- [ ] Need to ensure `missing_info` prompts are generated with proper `contact_id` and `missingField`
- [ ] Voice input shows "coming soon" placeholder
- [ ] Prompt text still shows template variables sometimes ({{contact_name}})

## Testing
- **Test account:** ann@gmail.com / ann12345
- **Staging:** https://newstaging.yourstruly.love (v1 only)
- **Local:** http://localhost:3000

## Git History (Recent)
- `db2f82f` â€” Add progress tracker + fix contact names + UI improvements
- `3efeb8e` â€” UI improvements: larger tiles, better spacing, contact forms

---

## Session Notes

### 2026-02-21 Morning Session
Major UI work on engagement bubbles:

**Issues Fixed:**
1. Tiles overlapping/moving with cursor â†’ Fixed layout, removed rotation/hover effects
2. "Unknown Contact" showing â†’ Added fallback to user's contacts list
3. Tile transparency â†’ Changed to solid white background
4. Tiles draggable â†’ Disabled with draggable={false}
5. Counter above tiles â†’ Replaced with progress tracker
6. No progress visualization â†’ Added animated progress tracker bar

**Features Added:**
1. Progress tracker showing completed tiles as thumbnails
2. Contact form inputs for missing_info prompts (date, phone, email fields)
3. Larger tiles (240x210) with more spacing (24px gap)

**Files Modified:**
- `src/app/(dashboard)/dashboard/page.tsx`
- `src/components/engagement/EngagementBubbles.tsx`
- `src/components/engagement/Bubble.tsx`
- `src/hooks/useEngagementPrompts.ts`
- `src/styles/engagement.css`
- `src/styles/home.css`
- `src/app/api/engagement/prompts/route.ts`
