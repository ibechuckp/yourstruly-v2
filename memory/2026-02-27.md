# YoursTruly V2 - Deployment Phase 1 Audit
**Date:** Friday, February 27, 2026 12:00 AM EST

## Summary
Completed Phase 1 deployment preparation. Build now succeeds after fixing ~30 TypeScript/compatibility issues.

---

## ‚úÖ Completed Tasks

### 1. Build Fixes
Fixed all TypeScript errors and Next.js 16 compatibility issues:
- Installed missing dependencies: `@stripe/react-stripe-js`, `@headlessui/react`, `@heroicons/react`
- Fixed Next.js 15+ Promise params pattern in API routes
- Fixed Supabase join array type mismatches
- Updated Stripe API version to `2026-01-28.clover`
- Fixed framer-motion animation variant types
- Fixed useSearchParams Suspense boundary requirement
- Updated component props to match hook interfaces
- Removed invalid emoji references from mood definitions

**Commit:** `a869889` - "Fix TypeScript errors and Next.js 16 compatibility issues"

### 2. next.config.ts Review
Current configuration is production-ready:
- Remote image patterns configured for Supabase, Unsplash, Prodigi, Floristone, Google
- No server-side env exposure issues

### 3. API Routes Check
All 70+ API routes compile and build successfully.

---

## üìã Environment Variables for Production

### Required (Core)
```
NEXT_PUBLIC_SUPABASE_URL=https://ffgetlejrwhpwvwtviqm.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=<supabase-anon-key>
SUPABASE_SERVICE_ROLE_KEY=<supabase-service-role-key>
NEXT_PUBLIC_APP_URL=https://yourstruly.love  # UPDATE FOR PRODUCTION
```

### Required (Payments)
```
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_live_...
STRIPE_SECRET_KEY=sk_live_...
STRIPE_WEBHOOK_SECRET=whsec_...  # ‚ö†Ô∏è NEEDED - Create in Stripe dashboard
STRIPE_PRODUCT_PREMIUM=prod_U2rXLfgtPvpmfE
STRIPE_PRICE_PREMIUM_MONTHLY=price_1T4lnyH94XbyUkwA9PV0uiIz
STRIPE_PRICE_PREMIUM_YEARLY=price_1T4ltlH94XbyUkwABUSWR6f7
```

### Required (AI/Voice)
```
ANTHROPIC_API_KEY=sk-ant-...
GEMINI_API_KEY=AIzaSy...
DEEPGRAM_API_KEY=<deepgram-key>
OPENAI_API_KEY=sk-proj-...  # For voice sessions
```

### Required (Auth)
```
GOOGLE_CLIENT_ID=<google-oauth-client-id>
GOOGLE_CLIENT_SECRET=<google-oauth-secret>
```

### Required (SMS)
```
TELNYX_API_KEY=KEY...
TELNYX_FROM_NUMBER=+1XXXXXXXXXX  # ‚ö†Ô∏è UPDATE WITH REAL NUMBER
```

### Optional (Marketplace)
```
PRODIGI_API_KEY=<prodigi-key>
PRODIGI_SANDBOX=false  # Change to false for production
FLORISTONE_API_KEY=<floristone-key>
FLORISTONE_API_PASSWORD=<floristone-password>
```

### Optional (Map)
```
NEXT_PUBLIC_MAPBOX_TOKEN=pk.eyJ1...
```

---

## ‚ö†Ô∏è Issues to Address Before Production

### High Priority
1. **STRIPE_WEBHOOK_SECRET** - Not in .env.local, needs to be created in Stripe Dashboard
2. **TELNYX_FROM_NUMBER** - Currently placeholder `+1XXXXXXXXXX`
3. **NEXT_PUBLIC_APP_URL** - Currently `http://localhost:3000`, needs production URL

### Medium Priority
4. **Middleware deprecation warning** - Next.js 16 deprecated middleware convention, should migrate to "proxy"
5. **npm audit** - 23 vulnerabilities (21 low, 1 moderate, 1 high) - run `npm audit fix`

### Low Priority
6. **Telnyx SDK** - Type mismatch, using @ts-expect-error workaround
7. **CartDrawer** - Hook interface mismatch patched but should be properly refactored

---

## üì¶ AWS Amplify Configuration

### amplify.yml (suggested)
```yaml
version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
    build:
      commands:
        - npm run build
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*
```

### Environment Variables in Amplify Console
Set all required env vars in Amplify Console ‚Üí App settings ‚Üí Environment variables

### Build Settings
- Node.js version: 20.x or 22.x
- Build command: `npm run build`
- Output directory: `.next`

---

## Next Steps
1. [ ] Push commit to GitHub
2. [ ] Create Stripe webhook endpoint
3. [ ] Configure Telnyx phone number
4. [ ] Set up Amplify app
5. [ ] Configure production environment variables
6. [ ] Run `npm audit fix`
7. [ ] Test deployment on staging first

---

*Generated by Zima during YT Deployment Phase 1 cron job*
